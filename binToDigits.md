# 8-bit符号無し整数の十進数表記

8-bit符号無し整数(0..255)を十進数表記にしたときの、百、十、一の位が何かを求める、という[話題](https://twitter.com/kuina_ch/status/1005039862670479360)がありました。おそらく効率の良いアセンブリコードがあると思いますが、再発明してみましょう。

「ハッカーのたのしみ」的な王道としては、逆数 (1/10) * 掛けられる数の最大値+1 (256)を掛けるというものです。実際、(i + 1) * 51 / 512ではi/10が求まります。これは、以下の式変形で求まります。

```text
= (i + 1) * 51 / 512
= (10 * j + k + 1) * 51 / 512 : i = 10 * j + k, j = 0..25, k=0..9
= (510 * j + k * 51 + 51) / 512
= (512 * j + k * 51 + 51 - 2 * j) / 512
= j + (k * 51 + 51 - 2 * (25 - j')) / 512 : j' = 25 - j = 0..25
= j + (1 + k * 51 + 2 * j') / 512
小数点以下を切り捨てると j : 1 <= (1 + k * 51 + 2 * j') <= 509 < 512
```

i=255の場合もこの式は成り立ちますが、i=256が8-bit符号無し整数で0になってしまうのを、min(255, (i + 1)) * 51 / 512 として回避する必要があります。

これでi/10が求まりましたので、ここから百の位と一の位を求めれば、十進数表記が求まります。コードは、[cppFriendsSampleAsm.cpp](cppFriendsSampleAsm.cpp)のTestSplitDigitsにあります。CPU命令に乗算があればもっとすっきり書けるでしょう。


